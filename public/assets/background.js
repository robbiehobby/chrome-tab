import{d as c}from"./chrome.js";async function i(){return(await chrome.storage.local.get(["settings"])).settings||structuredClone(c)}async function d(t){await chrome.storage.local.set({settings:t})}async function u(){return(await chrome.commands.getAll())[1].shortcut}chrome.tabs.onCreated.addListener(async t=>{(await i()).closeEmpty||(await chrome.tabs.query({url:"chrome://newtab/"})).forEach(n=>{n.id&&n.id!==t.id&&chrome.tabs.remove(n.id)})});async function g(){const t=await chrome.windows.getCurrent({populate:!0});if(!t.tabs||t.tabs.length===0)return;const e=t.tabs.find(a=>a.active);if(!e||!e.id)return;const n=await i(),{closePinned:r,closeGrouped:o}=n;if(!(r&&e.pinned||o&&e.groupId!==-1))try{t.tabs.filter(s=>!s.pinned&&s.groupId===-1&&s.id!==e.id).length||await chrome.tabs.create({}),await chrome.tabs.remove(e.id)}catch{}}chrome.runtime.onMessage.addListener((t,e,n)=>{switch(t.type){case"getSettings":return i().then(r=>n(r)),!0;case"saveSettings":d(t.payload);break;case"getShortcut":return u().then(r=>n(r)),!0}});chrome.commands.onCommand.addListener(t=>{t==="close"&&g()});
