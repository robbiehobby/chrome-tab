"use strict";var s={data:"",style:"cover",size:"100",opacity:"100",contrast:"1",hue:"0",grayscale:"0",blur:"0"},S={protectPinned:!0,protectGroups:!0},c={dim:!0,theme:"auto",color:"",image:s,tab:S};var t={form:document.getElementById("form"),formToggle:document.getElementById("formToggle"),formToggleDim:document.querySelector('input[name="formToggleDim"]'),theme:document.querySelector('select[name="theme"]'),themeDefault:document.querySelector('option[value="auto"]'),color:document.querySelector('input[name="color"]'),colorHex:document.getElementById("colorHex"),imageSettings:document.getElementById("imageSettings"),imageChoose:document.getElementById("imageChoose"),imageData:document.querySelector('input[name="imageData"]'),imageSize:document.querySelector('input[name="imageSize"]'),imageOpacity:document.querySelector('input[name="imageOpacity"]'),imageContrast:document.querySelector('input[name="imageContrast"]'),imageHue:document.querySelector('input[name="imageHue"]'),imageGrayscale:document.querySelector('input[name="imageGrayscale"]'),imageBlur:document.querySelector('input[name="imageBlur"]'),imageRemove:document.getElementById("imageRemove"),imageOverlay:document.getElementById("imageOverlay"),shortcutLink:document.getElementById("shortcutLink"),tabShortcut:document.getElementById("tabShortcut"),tabProtectPinned:document.querySelector('input[name="tabProtectPinned"]'),tabProtectGroups:document.querySelector('input[name="tabProtectGroups"]'),reset:document.getElementById("reset")},h=!1,l=!1,i="",r=!1;function E(){function m(){let e=structuredClone(c),a=new FormData(t.form);e.dim=t.formToggleDim.checked,e.theme=String(a.get("theme")),e.color=l?String(a.get("color")):"",e.image.data=i,e.image.style=String(a.get("imageStyle")),e.image.size=String(a.get("imageSize")),e.image.opacity=String(a.get("imageOpacity")),e.image.contrast=String(a.get("imageContrast")),e.image.hue=String(a.get("imageHue")),e.image.grayscale=String(a.get("imageGrayscale")),e.image.blur=String(a.get("imageBlur")),e.tab.protectPinned=t.tabProtectPinned.checked,e.tab.protectGroups=t.tabProtectGroups.checked,chrome.storage.local.set({settings:e})}function n(e=""){if(!e||!l){let{theme:a}=document.documentElement.dataset;a==="auto"&&(a=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),t.color.value=a==="dark"?"#16191e":"#e4e6e6",l=!1}document.documentElement.style.backgroundColor=l?e:"",l?t.colorHex.innerText=e:t.colorHex.innerText=chrome.i18n.getMessage("AC16E85FC79F")}function o(){i?(t.imageSettings.classList.remove("hidden"),t.imageChoose.classList.add("hidden"),t.imageData.disabled=!0,t.imageRemove.classList.remove("hidden")):(t.imageSettings.classList.add("hidden"),t.imageChoose.classList.remove("hidden"),t.imageData.disabled=!1,t.imageRemove.classList.add("hidden"))}function u(e){if(e===!1&&(i="",r=!1),o(),!h&&i)t.imageOverlay.style.backgroundImage=`url("${i}")`;else if((!e||e.size===0)&&!r&&!i)t.imageOverlay.style.backgroundImage="",t.imageData.value="";else if(e&&r){if(r=!1,e.size===0)return;if(e.size>8e6){alert(chrome.i18n.getMessage("C0424E559A00"));return}let a=new FileReader;a.onloadend=()=>{i=String(a.result),t.imageOverlay.style.backgroundImage=`url("${i}")`,m(),o()},a.readAsDataURL(e)}}function d(e=structuredClone(s)){e.style==="cover"?t.imageOverlay.style.backgroundSize=e.style:t.imageOverlay.style.backgroundSize=`${e.size}%`,t.imageOverlay.style.backgroundRepeat=e.style==="repeat"?"repeat":"",t.imageOverlay.style.opacity=`${e.opacity}%`;let a=[];e.contrast&&a.push(`contrast(${e.contrast})`),e.hue&&a.push(`hue-rotate(${e.hue}deg)`),e.grayscale&&a.push(`grayscale(${e.grayscale})`),e.blur&&a.push(`blur(${e.blur}px)`),t.imageOverlay.style.filter=a.length?a.join(" "):"",t.imageSize.value=e.size,t.imageOpacity.value=e.opacity,t.imageContrast.value=e.contrast,t.imageHue.value=e.hue,t.imageGrayscale.value=e.grayscale,t.imageBlur.value=e.blur,document.querySelectorAll('input[name="style"]').forEach(g=>{g.checked=g.value===e.style})}function y(){let e=new FormData(t.form),a=String(e.get("theme"));a==="auto"&&(a=window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),document.documentElement.dataset.theme=a,(this==null?void 0:this.name)==="color"&&(l=!0),(this==null?void 0:this.name)==="imageData"&&(r=!0),e.get("style")||e.set("style","center"),n(String(e.get("color"))),u(e.get("imageData")),d({data:i,style:String(e.get("imageStyle")),size:String(e.get("imageSize")),opacity:String(e.get("imageOpacity")),contrast:String(e.get("imageContrast")),hue:String(e.get("imageHue")),grayscale:String(e.get("imageGrayscale")),blur:String(e.get("imageBlur"))}),t.formToggleDim.checked?t.formToggle.classList.add("dim"):t.formToggle.classList.remove("dim"),h=!0}document.querySelectorAll("input, select").forEach(e=>{e.addEventListener("input",y),e.name==="color"&&e.addEventListener("input",m),e.name!=="image"&&e.addEventListener("change",m)}),chrome.commands.getAll().then(e=>{let a=e.filter(g=>g.name==="close-tab");!a.length||!a[0].shortcut||(t.tabShortcut.classList.add("text-primary"),t.tabShortcut.innerText=a[0].shortcut.split("").join(" "))});function f(e=null){e==="color"?n():e==="image"&&(u(!1),d()),m()}t.imageRemove.addEventListener("click",()=>{window.confirm(chrome.i18n.getMessage("79D0EF9D2054"))&&f("image")}),t.reset.addEventListener("click",()=>{window.confirm(chrome.i18n.getMessage("5EC0C7595A59"))&&f("color")}),y()}chrome.storage.local.get(["settings"]).then(m=>{if(m.settings){let{settings:n}=m;n={...c,...n},l=!!n.color,i=n.image.data,t.formToggleDim.checked=n.dim,t.theme.value=n.theme,n.color&&(t.color.value=n.color),t.imageSize.value=n.image.size,t.imageOpacity.value=n.image.opacity,t.imageContrast.value=n.image.contrast,t.imageHue.value=n.image.hue,t.imageGrayscale.value=n.image.grayscale,t.imageBlur.value=n.image.blur,t.tabProtectPinned.checked=n.tab.protectPinned,t.tabProtectGroups.checked=n.tab.protectGroups;let o=document.querySelector(`input[name="imageStyle"][value="${n.image.style}"]`);o&&(o.checked=!0)}E()});t.shortcutLink.addEventListener("click",()=>{chrome.tabs.create({url:"chrome://extensions/shortcuts"})});
