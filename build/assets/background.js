chrome.commands.onCommand.addListener(s=>{s==="close-tab"&&chrome.windows.getCurrent({populate:!0},async r=>{var n;if(!r.tabs||r.tabs.length===0)return;const t=r.tabs.find(e=>e.active);if(!(t!=null&&t.id))return;const{settings:a}=await chrome.storage.local.get(["settings"]),{closeTabPinned:c,closeTabGrouped:o}=a;if(c&&t.pinned||o&&t.groupId!==-1)return;const i=r.tabs.filter(e=>!e.pinned&&e.groupId===-1&&e.id!==t.id);try{if(!i.length){if((n=t.url)!=null&&n.match(/^\w+:\/\/newtab\//))return;await chrome.tabs.create({})}await chrome.tabs.remove(t.id)}catch{}})});
